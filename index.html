<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ÎπÑÎîîÏò§ Î©îÎ™® - ÎèôÍ∏∞Ìôî</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: #4CAF50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff0000;
        }

        .sync-indicator.connected {
            background: #00ff00;
        }

        .tabs {
            display: flex;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            border: none;
            background: white;
            font-size: 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

        .content {
            display: none;
            padding: 15px;
        }

        .content.active {
            display: block;
        }

        .input-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        button {
            width: 100%;
            padding: 14px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }

        button:active {
            background: #45a049;
        }

        .item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .item-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .item-url {
            color: #1a73e8;
            word-break: break-all;
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-block;
            margin: 5px 0;
        }

        .item-thumb {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
        }

        .item-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-small {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            color: white;
        }

        .btn-edit {
            background: #2196F3;
        }

        .btn-delete {
            background: #f44336;
        }

        .empty {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .memo-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .memo-text {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .memo-date {
            color: #666;
            font-size: 0.85rem;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        /* Ìé∏Ïßë Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-footer button {
            flex: 1;
        }

        .btn-cancel {
            background: #ccc;
            color: #333;
        }

        .sync-status {
            text-align: center;
            padding: 10px;
            background: #fff3cd;
            color: #856404;
            margin: 10px;
            border-radius: 5px;
            display: none;
        }

        .sync-status.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        üì± ÎπÑÎîîÏò§ & Î©îÎ™®
        <div class="sync-indicator" id="syncIndicator" title="ÎèôÍ∏∞Ìôî ÏÉÅÌÉú"></div>
    </div>
    
    <div class="sync-status" id="syncStatus">Ïó∞Í≤∞ Ï§ë...</div>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('video')">üé¨ ÎπÑÎîîÏò§</button>
        <button class="tab" onclick="showTab('memo')">üìù Î©îÎ™®</button>
    </div>

    <div id="videoTab" class="content active">
        <div class="input-box">
            <input type="text" id="vTitle" placeholder="Ï†úÎ™©">
            <input type="text" id="vUrl" placeholder="YouTube URL">
            <button onclick="addVideo()">ÎπÑÎîîÏò§ Ï∂îÍ∞Ä</button>
        </div>
        <div id="videoList">
            <div class="loading">Ïó∞Í≤∞ Ï§ë...</div>
        </div>
    </div>

    <div id="memoTab" class="content">
        <div class="input-box">
            <textarea id="memoText" rows="4" placeholder="Î©îÎ™® ÏûÖÎ†•..."></textarea>
            <button onclick="addMemo()">Î©îÎ™® Ï∂îÍ∞Ä</button>
        </div>
        <div id="memoList">
            <div class="loading">Ïó∞Í≤∞ Ï§ë...</div>
        </div>
    </div>

    <!-- ÎπÑÎîîÏò§ Ìé∏Ïßë Î™®Îã¨ -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">ÎπÑÎîîÏò§ ÏàòÏ†ï</div>
            <input type="text" id="editVideoTitle" placeholder="Ï†úÎ™©">
            <input type="text" id="editVideoUrl" placeholder="URL">
            <div class="modal-footer">
                <button onclick="saveVideoEdit()">Ï†ÄÏû•</button>
                <button class="btn-cancel" onclick="closeVideoModal()">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Î©îÎ™® Ìé∏Ïßë Î™®Îã¨ -->
    <div class="modal" id="memoModal">
        <div class="modal-content">
            <div class="modal-header">Î©îÎ™® ÏàòÏ†ï</div>
            <textarea id="editMemoText" rows="6" placeholder="Î©îÎ™® ÎÇ¥Ïö©"></textarea>
            <div class="modal-footer">
                <button onclick="saveMemoEdit()">Ï†ÄÏû•</button>
                <button class="btn-cancel" onclick="closeMemoModal()">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyCW5d5Txi0-6H7-GFxcaRcU_x3wK6YFA78",
            authDomain: "video-memo-8f984.firebaseapp.com",
            databaseURL: "https://video-memo-8f984-default-rtdb.firebaseio.com",
            projectId: "video-memo-8f984",
            storageBucket: "video-memo-8f984.firebasestorage.app",
            messagingSenderId: "874134651920",
            appId: "1:874134651920:web:fbd3f0d94cb239c8e4f695"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Ï†ÑÏó≠ Î≥ÄÏàò
        window.videos = {};
        window.memos = {};
        window.editingVideoKey = null;
        window.editingMemoKey = null;
        window.isConnected = false;

        // Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
        const connectedRef = ref(database, '.info/connected');
        onValue(connectedRef, (snapshot) => {
            const connected = snapshot.val();
            const indicator = document.getElementById('syncIndicator');
            const status = document.getElementById('syncStatus');
            
            if (connected) {
                console.log('Firebase Ïó∞Í≤∞Îê®');
                indicator.classList.add('connected');
                status.textContent = 'ÎèôÍ∏∞Ìôî Ïó∞Í≤∞Îê®';
                status.classList.add('show');
                setTimeout(() => status.classList.remove('show'), 2000);
                window.isConnected = true;
            } else {
                console.log('Firebase Ïó∞Í≤∞ ÎÅäÍπÄ');
                indicator.classList.remove('connected');
                status.textContent = 'Ïó∞Í≤∞ ÎÅäÍπÄ - Ïû¨Ïó∞Í≤∞ Ï§ë...';
                status.classList.add('show');
                window.isConnected = false;
            }
        });

        // ÌÉ≠ Ï†ÑÌôò
        window.showTab = function(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            if(tab === 'video') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('videoTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('memoTab').classList.add('active');
            }
        }

        // ÎπÑÎîîÏò§ Ï∂îÍ∞Ä
        window.addVideo = function() {
            if (!window.isConnected) {
                alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî.');
                return;
            }

            const title = document.getElementById('vTitle').value.trim();
            const url = document.getElementById('vUrl').value.trim();
            
            if(!title || !url) {
                alert('Ï†úÎ™©Í≥º URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            let videoId = '';
            let thumb = '';
            
            if(url.includes('youtube.com/watch')) {
                videoId = url.split('v=')[1]?.split('&')[0];
            } else if(url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1]?.split('?')[0];
            } else if(url.includes('youtube.com/shorts/')) {
                videoId = url.split('shorts/')[1]?.split('?')[0];
            }
            
            if(videoId) {
                thumb = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            }

            // FirebaseÏóê Ï†ÄÏû•
            const videosRef = ref(database, 'videos');
            push(videosRef, {
                title: title,
                url: url,
                thumb: thumb,
                date: new Date().toISOString()
            }).then(() => {
                console.log('ÎπÑÎîîÏò§ Ï∂îÍ∞ÄÎê®');
                document.getElementById('vTitle').value = '';
                document.getElementById('vUrl').value = '';
            }).catch((error) => {
                console.error('ÎπÑÎîîÏò§ Ï∂îÍ∞Ä Ïã§Ìå®:', error);
                alert('Ï∂îÍ∞Ä Ïã§Ìå®: ' + error.message);
            });
        }

        // ÎπÑÎîîÏò§ Î™©Î°ù Î†åÎçîÎßÅ
        function renderVideos() {
            const list = document.getElementById('videoList');
            const videoArray = Object.entries(window.videos).sort((a, b) => 
                new Date(b[1].date) - new Date(a[1].date)
            );
            
            if(videoArray.length === 0) {
                list.innerHTML = '<div class="empty">ÎπÑÎîîÏò§Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            list.innerHTML = videoArray.map(([key, v]) => `
                <div class="item">
                    <div class="item-title">${v.title}</div>
                    ${v.thumb ? `<img src="${v.thumb}" class="item-thumb" onclick="window.open('${v.url}','_blank')">` : ''}
                    <a href="${v.url}" target="_blank" class="item-url">${v.url}</a>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editVideo('${key}')">ÏàòÏ†ï</button>
                        <button class="btn-small btn-delete" onclick="deleteVideo('${key}')">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
            `).join('');
        }

        // ÎπÑÎîîÏò§ ÏàòÏ†ï
        window.editVideo = function(key) {
            const video = window.videos[key];
            if (!video) return;
            
            window.editingVideoKey = key;
            document.getElementById('editVideoTitle').value = video.title;
            document.getElementById('editVideoUrl').value = video.url;
            document.getElementById('videoModal').classList.add('active');
        }

        window.saveVideoEdit = function() {
            if (!window.isConnected) {
                alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            const title = document.getElementById('editVideoTitle').value.trim();
            const url = document.getElementById('editVideoUrl').value.trim();
            
            if (!title || !url) {
                alert('Ï†úÎ™©Í≥º URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            let videoId = '';
            let thumb = '';
            
            if(url.includes('youtube.com/watch')) {
                videoId = url.split('v=')[1]?.split('&')[0];
            } else if(url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1]?.split('?')[0];
            } else if(url.includes('youtube.com/shorts/')) {
                videoId = url.split('shorts/')[1]?.split('?')[0];
            }
            
            if(videoId) {
                thumb = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            }

            const videoRef = ref(database, `videos/${window.editingVideoKey}`);
            update(videoRef, {
                title: title,
                url: url,
                thumb: thumb,
                date: new Date().toISOString()
            }).then(() => {
                closeVideoModal();
            });
        }

        window.closeVideoModal = function() {
            document.getElementById('videoModal').classList.remove('active');
            window.editingVideoKey = null;
        }

        // ÎπÑÎîîÏò§ ÏÇ≠Ï†ú
        window.deleteVideo = function(key) {
            if (!window.isConnected) {
                alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            if(confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                const videoRef = ref(database, `videos/${key}`);
                remove(videoRef).then(() => {
                    console.log('ÎπÑÎîîÏò§ ÏÇ≠Ï†úÎê®');
                }).catch((error) => {
                    console.error('ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                });
            }
        }

        // Î©îÎ™® Ï∂îÍ∞Ä
        window.addMemo = function() {
            if (!window.isConnected) {
                alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî.');
                return;
            }

            const text = document.getElementById('memoText').value.trim();
            
            if(!text) {
                alert('Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            // FirebaseÏóê Ï†ÄÏû•
            const memosRef = ref(database, 'memos');
            push(memosRef, {
                text: text,
                date: new Date().toISOString()
            }).then(() => {
                console.log('Î©îÎ™® Ï∂îÍ∞ÄÎê®');
                document.getElementById('memoText').value = '';
            }).catch((error) => {
                console.error('Î©îÎ™® Ï∂îÍ∞Ä Ïã§Ìå®:', error);
                alert('Ï∂îÍ∞Ä Ïã§Ìå®: ' + error.message);
            });
        }

        // Î©îÎ™® Î™©Î°ù Î†åÎçîÎßÅ
        function renderMemos() {
            const list = document.getElementById('memoList');
            const memoArray = Object.entries(window.memos).sort((a, b) => 
                new Date(b[1].date) - new Date(a[1].date)
            );
            
            if(memoArray.length === 0) {
                list.innerHTML = '<div class="empty">Î©îÎ™®Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            list.innerHTML = memoArray.map(([key, m]) => `
                <div class="memo-item">
                    <div class="memo-text">${linkify(escapeHtml(m.text))}</div>
                    <div class="memo-date">${new Date(m.date).toLocaleString('ko-KR')}</div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editMemo('${key}')">ÏàòÏ†ï</button>
                        <button class="btn-small btn-delete" onclick="deleteMemo('${key}')">ÏÇ≠Ï†ú</button>
                    </div>
                </div>
            `).join('');
        }

        // Î©îÎ™® ÏàòÏ†ï
        window.editMemo = function(key) {
            const memo = window.memos[key];
            if (!memo) return;
            
            window.editingMemoKey = key;
            document.getElementById('editMemoText').value = memo.text;
            document.getElementById('memoModal').classList.add('active');
        }

        window.saveMemoEdit = function() {
            if (!window.isConnected) {
                alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            const text = document.getElementById('editMemoText').value.trim();
            
            if (!text) {
                alert('Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                return;
            }

            const memoRef = ref(database, `memos/${window.editingMemoKey}`);
            update(memoRef, {
                text: text,
                date: new Date().toISOString()
            }).then(() => {
                closeMemoModal();
            });
        }

        window.closeMemoModal = function() {
            document.getElementById('memoModal').classList.remove('active');
            window.editingMemoKey = null;
        }

        // Î©îÎ™® ÏÇ≠Ï†ú
        window.deleteMemo = function(key) {
            if (!window.isConnected) {
                alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            if(confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                const memoRef = ref(database, `memos/${key}`);
                remove(memoRef).then(() => {
                    console.log('Î©îÎ™® ÏÇ≠Ï†úÎê®');
                }).catch((error) => {
                    console.error('ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                });
            }
        }

        // HTML Ïù¥Ïä§ÏºÄÏù¥ÌîÑ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // URL ÎßÅÌÅ¨ Î≥ÄÌôò
        function linkify(text) {
            const urlPattern = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
            return text.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
        }

        // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Î¶¨Ïä§ÎÑà
        const videosRef = ref(database, 'videos');
        onValue(videosRef, (snapshot) => {
            console.log('ÎπÑÎîîÏò§ Îç∞Ïù¥ÌÑ∞ ÏàòÏã†');
            window.videos = snapshot.val() || {};
            renderVideos();
        });

        const memosRef = ref(database, 'memos');
        onValue(memosRef, (snapshot) => {
            console.log('Î©îÎ™® Îç∞Ïù¥ÌÑ∞ ÏàòÏã†');
            window.memos = snapshot.val() || {};
            renderMemos();
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
                window.editingVideoKey = null;
                window.editingMemoKey = null;
            }
        }
    </script>
</body>
</html>
